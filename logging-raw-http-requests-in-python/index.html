<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/assets/css/main.css" /><title>Logging Raw HTTP Requests in Python - Secario Labs</title>
  <meta
    name="description"
    content="Quite often, during our red team engagements, we find ourselves in a situation where we need to carry out web research &amp;amp; exploitation over several chained proxies. To that extended, to be able to do any reasonable web testing we need to be able to see the requests we send..."
  /><link
    rel="canonical"
    href="https://secariolabs.github.io/logging-raw-http-requests-in-python/"
  /><link rel="icon" type="image/png" href="/assets/images/favicon/favicon-96x96--white.png" sizes="96x96" media="(prefers-color-scheme: dark)">
<link rel="icon" type="image/svg+xml" href="/assets/images/favicon/favicon--white.svg" media="(prefers-color-scheme: dark)">
<link rel="icon" type="image/png" href="/assets/images/favicon/favicon-96x96.png" sizes="96x96" media="(prefers-color-scheme: light)">
<link rel="icon" type="image/svg+xml" href="/assets/images/favicon/favicon.svg" media="(prefers-color-scheme: light)">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/apple-touch-icon.png">
<meta name="apple-mobile-web-app-title" content="SecarioLabs">
<link rel="manifest" href="/site.webmanifest"><meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@SecarioLabs" />
<meta name="twitter:title" content="Logging Raw HTTP Requests in Python" />
<meta name="twitter:description" content="Quite often, during our red team engagements, we find ourselves in a situation where we need to carry out web research &amp; exploitation over several chained proxies. To that extended, to be able to do any reasonable web testing we need to be able to see the requests we send to the server and the corresponding replies. Tools like BurpSuite and mitmproxy can be helpful, however, by themselves, they introduce a lot of additional complexity, traffic overhead, and they are not very easy to configure in terms of what and how it is being logged. Sometimes you just want to have control over the data and do something with it. Because of that, our weapon of choice for most of these edge cases is Python with ProxyChains. The reason we like Python is because it is easy to enable HTTP request/response logging with the minimal amount of code." />
<meta name="twitter:image" content="https://secariolabs.github.io/assets/images/posts/data-center-with-server-racks-2022-07-26-17-02-57-utc-1200x470.jpg" />

<meta property="og:type" content="article" />
<meta property="og:title" content="Logging Raw HTTP Requests in Python" />
<meta property="og:description" content="Quite often, during our red team engagements, we find ourselves in a situation where we need to carry out web research &amp; exploitation over several chained proxies. To that extended, to be able to do any reasonable web testing we need to be able to see the requests we send to the server and the corresponding replies. Tools like BurpSuite and mitmproxy can be helpful, however, by themselves, they introduce a lot of additional complexity, traffic overhead, and they are not very easy to configure in terms of what and how it is being logged. Sometimes you just want to have control over the data and do something with it. Because of that, our weapon of choice for most of these edge cases is Python with ProxyChains. The reason we like Python is because it is easy to enable HTTP request/response logging with the minimal amount of code." />
<meta property="og:url" content="https://secariolabs.github.io/logging-raw-http-requests-in-python/" />
<meta property="og:image" content="https://secariolabs.github.io/assets/images/posts/data-center-with-server-racks-2022-07-26-17-02-57-utc-1200x470.jpg" />
<link type="application/atom+xml" rel="alternate" href="https://secariolabs.github.io/feed.xml" title="Your awesome title" /></head>
<body data-prismjs-copy='' data-prismjs-copy-success=''><header  id="site-header"  class="site-header"><div class="banner hidden" id="banner">
    <div class="container container--xl">
        <p class="banner__title">
            <strong>We’ll beat any Web Application Penetration Test Quote You've Received <em>By 15%!</em></strong>
        </p>
        <p><a class="text-muted text-xs" href="/terms-and-conditions/">
                    Terms and coditions apply
                </a></p>
    </div><div class="banner__tag">
            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#921F20" viewBox="0 0 100 100"><path d="M61.223 61.836c0 4.492-6.734 4.492-6.734 0 0-4.488 6.734-4.488 6.734 0M45.512 46.223c0 4.492-6.734 4.492-6.734 0 0-4.488 6.734-4.488 6.734 0"/><path d="m27.551 85.203 21.328-12.961c.203-.203.715-.203 1.02-.203.203 0 .406 0 .613.203L71.43 85.203v-53.57H27.55zm30.305-16.938a6.403 6.403 0 0 1-6.43-6.43c0-3.57 2.856-6.43 6.43-6.43 3.57 0 6.43 2.856 6.43 6.43 0 3.57-2.856 6.43-6.43 6.43zm4.695-26.836a1.601 1.601 0 0 1 0 2.246L40.305 65.917a1.578 1.578 0 0 1-2.144.102l-.102-.102a1.69 1.69 0 0 1 0-2.144l22.348-22.348a1.695 1.695 0 0 1 2.145.004zm-20.406-1.633c3.57 0 6.43 2.856 6.43 6.43 0 3.57-2.856 6.43-6.43 6.43-3.57-.102-6.328-2.856-6.43-6.43a6.4 6.4 0 0 1 6.43-6.43zM27.551 15.305H71.43v13.266H27.551z"/></svg>
        </div><button class="banner__close" id="close-banner">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="icon icon-tabler icons-tabler-outline icon-tabler-x" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z"/><path d="M18 6 6 18M6 6l12 12"/></svg>
    </button>
</div><nav id="site-nav" class="site-nav">
        <div class="container container--xl">
            <a href="/" class="site-nav__logo-link">
                <img class="site-nav__logo" src="/assets/images/secario-labs-logo.png" alt="Secario Labs logo" width="462" height="58">
            </a>

            <ul class="site-nav__items" id="nav">
                
                    <li class="site-nav__item"><a href="/about-us" class="site-nav__link">About Us</a></li>
                
                    <li class="site-nav__item"><a href="/services/" class="site-nav__link">Services</a></li>
                
                    <li class="site-nav__item"><a href="/defence/" class="site-nav__link">Defence</a></li>
                
                    <li class="site-nav__item"><a href="/blog/" class="site-nav__link site-nav__link--active">Blog</a></li>
                
                    <li class="site-nav__item"><button class="btn btn--md btn--light uppercase" data-open-modal>Book a call</button></li>
                
            </ul>

            <button class="burger" id="menu-btn"><svg width="32" height="32">
    <rect id="line1" y="8" width="32" height="2"></rect>
    <rect id="line2" y="16" width="32" height="2"></rect>
    <rect id="line3" y="24" width="32" height="2"></rect>
</svg></button>
        </div>
    </nav>

</header><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-1a1a1a-ffffff-1">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.10196078431373 1"></feFuncR>
        <feFuncG type="table" tableValues="0.10196078431373 1"></feFuncG>
        <feFuncB type="table" tableValues="0.10196078431373 1"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-1a1a1a-c93b3b-4">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.10196078431373 0.78823529411765"></feFuncR>
        <feFuncG type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncG>
        <feFuncB type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-000000-ffffff-5">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0 1"></feFuncR>
        <feFuncG type="table" tableValues="0 1"></feFuncG>
        <feFuncB type="table" tableValues="0 1"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-c93b3b-ffffff-7">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.78823529411765 1"></feFuncR>
        <feFuncG type="table" tableValues="0.23137254901961 1"></feFuncG>
        <feFuncB type="table" tableValues="0.23137254901961 1"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-1a1a1a-c93b3b-1">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.10196078431373 0.78823529411765"></feFuncR>
        <feFuncG type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncG>
        <feFuncB type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-1a1a1a-c93b3b-2">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.10196078431373 0.78823529411765"></feFuncR>
        <feFuncG type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncG>
        <feFuncB type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg>

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;">
  <defs>
    <filter id="duotone-1a1a1a-c93b3b-3">
      <feColorMatrix color-interpolation-filters="sRGB" type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 "></feColorMatrix>
      <feComponentTransfer color-interpolation-filters="sRGB">
        <feFuncR type="table" tableValues="0.10196078431373 0.78823529411765"></feFuncR>
        <feFuncG type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncG>
        <feFuncB type="table" tableValues="0.10196078431373 0.23137254901961"></feFuncB>
        <feFuncA type="table" tableValues="1 1"></feFuncA>
      </feComponentTransfer>
      <feComposite in2="SourceGraphic" operator="in"></feComposite>
    </filter>
  </defs>
</svg><main aria-label="Content">
      <section class="hero hero--page hero--post"  style="background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.6) 0%,
  rgba(0, 0, 0, 0.7) 100%), url(/assets/images/posts/data-center-with-server-racks-2022-07-26-17-02-57-utc-1200x470.jpg);" >

  <div class="container container--sm">
    <h1 class="hero__heading hero__heading--page hero__heading--post">Logging Raw HTTP Requests in Python</h1><div class="blog__teaser-meta">
    <div class="blog__teaser-date-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24"><path d="M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7zM16 3v4M8 3v4M4 11h16M7 14h.013M10.01 14h.005M13.01 14h.005M16.015 14h.005M13.015 17h.005M7.01 17h.005M10.01 17h.005"/></svg>
        <time datetime="2023-02-05T19:50:55+00:00" class="span blog__teaser-date text-sm">
            February  5, 2023
        </time>
    </div></div></div>
</section><section class="post-wrapper">
  <section class="section section--page section--post">
    <div class="container container--sm">
      <div class="post__bc text-muted">
        <a
          class="post__bc-item text-muted underline"
          href="/"
          >Home</a
        >
        »
        <a
          class="post__bc-item text-muted underline"
          href="/blog/"
          >Blog</a
        >
        »
        <strong class="post__bc-item text-muted post__bc-item--active"
          >Logging Raw HTTP Requests in Python</strong
        >
      </div>

      <article class="post"><p>Quite often, during our red team engagements, we find ourselves in a situation where we need to carry out web research &amp; exploitation over several chained proxies. To that extended, to be able to do any reasonable web testing we need to be able to see the requests we send to the server and the corresponding replies. Tools like <strong>BurpSuite</strong> and <strong>mitmproxy</strong> can be helpful, however, by themselves, they introduce a lot of additional complexity, traffic overhead, and they are not very easy to configure in terms of what and how it is being logged. Sometimes you just want to have control over the data and do something with it. Because of that, our weapon of choice for most of these edge cases is <strong>Python</strong> with <strong>ProxyChains</strong>. The reason we like <strong>Python</strong> is because it is easy to enable HTTP request/response logging with the minimal amount of code.</p>

<p>The few techniques we are going to mention below could be used both for new scripts that you have built for a particular action, as well as if you want to modify an existing <strong>Python</strong> tool to have this additional, granular logging.</p>

<h2 id="request-patching">Request Patching</h2>

<p>By far the simplest fix to enable logging is to overwrite the <code class="language-plaintext highlighter-rouge">http.client.HTTPConnection.send</code> function, like the example below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">http</span>
<span class="kn">import</span> <span class="n">requests</span>

<span class="k">def</span> <span class="nf">patch_send</span><span class="p">():</span>
    <span class="n">old_send</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">HTTPConnection</span><span class="p">.</span><span class="n">send</span>
    <span class="k">def</span> <span class="nf">new_send</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="mi">9</span><span class="si">}</span><span class="s"> BEGIN REQUEST </span><span class="si">{</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="mi">9</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">).</span><span class="nf">strip</span><span class="p">())</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="mi">10</span><span class="si">}</span><span class="s"> END REQUEST </span><span class="si">{</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span><span class="o">*</span><span class="mi">10</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">old_send</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">HTTPConnection</span><span class="p">.</span><span class="n">send</span> <span class="o">=</span> <span class="n">new_send</span>

<span class="nf">patch_send</span><span class="p">()</span>

<span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http://secariolabs.com</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Once you do that, you will have full visibility over the requests in their final form, as show next:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">---------</span> BEGIN REQUEST <span class="nt">---------</span>
GET / HTTP/1.1
Host: secariolabs.com
User-Agent: python-requests/2.27.0
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive
<span class="nt">----------</span> END REQUEST <span class="nt">----------</span>
<span class="nt">---------</span> BEGIN REQUEST <span class="nt">---------</span>
GET / HTTP/1.1
Host: secariolabs.com
User-Agent: python-requests/2.27.0
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive
<span class="nt">----------</span> END REQUEST <span class="nt">----------</span>
</code></pre></div></div>

<p>Even though this technique is easy to implement and efficient, it is limited in that it can only log requests. To do the same action for responses, the process is a lot more primitive: in that case you need to hook the socket and just read any connections received by the client system, which wouldn’t work if you have any other service being used on the host or if you decide to use multithreading. The moment things get asynchronous or if there is any noise, this technique wouldn’t be able to accurately map a request to a response.</p>

<h2 id="verbose-logging">Verbose Logging</h2>

<p>One of the most popular and well documented techniques for implementing an additional logging could be enabled by setting <code class="language-plaintext highlighter-rouge">http.client.HTTPConnection.debuglevel</code> to <strong>1</strong>. Once you do that, you just need to create a logger and set the level to <code class="language-plaintext highlighter-rouge">DEBUG</code>, and you will be able to see the requests and responses.</p>

<p>An example configuration looks as follows:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">http</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">requests</span>

<span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">HTTPConnection</span><span class="p">.</span><span class="n">debuglevel</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">().</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">requests_log</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">"</span><span class="s">requests.packages.urllib3</span><span class="sh">"</span><span class="p">)</span>
<span class="n">requests_log</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">requests_log</span><span class="p">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://secariolabs.com</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>The output of the above script is included below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEBUG:urllib3.connectionpool:Starting new HTTP connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:80
send: b<span class="s1">'GET / HTTP/1.1\r\nHost: secariolabs.com\r\nUser-Agent: python-requests/2.27.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\n\r\n'</span>
reply: <span class="s1">'HTTP/1.1 301 Moved Permanently\r\n'</span>
header: Server: CloudFront
header: Date: Wed, 15 Jun 2022 23:24:14 GMT
header: Content-Type: text/html
header: Content-Length: 183
header: Connection: keep-alive
header: Location: https://secariolabs.com/
header: X-XSS-Protection: 1<span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block
header: X-Frame-Options: SAMEORIGIN
header: Referrer-Policy: strict-origin-when-cross-origin
header: X-Content-Type-Options: nosniff
header: X-Cache: Redirect from cloudfront
header: Via: 1.1 af69af45a94f94ec264bfb9a5a28f3aa.cloudfront.net <span class="o">(</span>CloudFront<span class="o">)</span>
header: X-Amz-Cf-Pop: LHR50-P1
header: X-Amz-Cf-Id: <span class="nv">h_JponMfq0LCm1DtsCG0gJ1b5i0sYwLTfSA4fBlGI4bG_MDvMklgSg</span><span class="o">==</span>
DEBUG:urllib3.connectionpool:http://secariolabs.com:80 <span class="s2">"GET / HTTP/1.1"</span> 301 183
DEBUG:urllib3.connectionpool:Starting new HTTPS connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:443
send: b<span class="s1">'GET / HTTP/1.1\r\nHost: secariolabs.com\r\nUser-Agent: python-requests/2.27.0\r\nAccept-Encoding: gzip, deflate\r\nAccept: */*\r\nConnection: keep-alive\r\n\r\n'</span>
reply: <span class="s1">'HTTP/1.1 200 OK\r\n'</span>
header: Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
header: Content-Length: 16347
header: Connection: keep-alive
header: Date: Wed, 15 Jun 2022 23:24:14 GMT
header: Server: Apache
header: Expires: Thu, 16 Jun 2022 00:24:14 GMT
header: Pragma: public
header: Cache-Control: max-age<span class="o">=</span>3600, public
header: X-Frame-Options: SAMEORIGIN
header: Strict-Transport-Security: max-age<span class="o">=</span>63072000
header: X-Mod-Pagespeed: 1.13.35.2-0
header: Content-Encoding: <span class="nb">gzip
</span>header: X-Frame-Options: SAMEORIGIN
header: X-Content-Type-Options: nosniff
header: Referrer-Policy: no-referrer-when-downgrade
header: X-Permitted-Cross-Domain-Policies: none
header: Feature-Policy: camera <span class="s1">'none'</span><span class="p">;</span> fullscreen <span class="s1">'self'</span><span class="p">;</span> geolocation <span class="k">*</span><span class="p">;</span> microphone <span class="s1">'none'</span>
header: Permissions-Policy: <span class="nv">geolocation</span><span class="o">=(</span><span class="k">*</span><span class="o">)</span>, <span class="nv">microphone</span><span class="o">=()</span>, <span class="nv">camera</span><span class="o">=()</span>, <span class="nv">fullscreen</span><span class="o">=(</span>self<span class="o">)</span>
header: Cache-Control: max-age<span class="o">=</span>0, no-cache, s-maxage<span class="o">=</span>10
header: Vary: Accept-Encoding
header: X-XSS-Protection: 1<span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block
header: X-Cache: Miss from cloudfront
header: Via: 1.1 c58391b07051938ceda6615614fbabb0.cloudfront.net <span class="o">(</span>CloudFront<span class="o">)</span>
header: X-Amz-Cf-Pop: LHR50-P1
header: X-Amz-Cf-Id: XwcrYUnvx9ixV7iIeo0BW5gxCsTyvnDAnR79S4P_vG6nJUF6V-LdNg<span class="o">==</span>
DEBUG:urllib3.connectionpool:https://secariolabs.com:443 <span class="s2">"GET / HTTP/1.1"</span> 200 16347
</code></pre></div></div>

<p>Even though this technique has many limitations, for the most part it could be considered sufficient if someone is just looking to collect full body requests and only response headers (notice there is no response body).</p>

<p>In principle, we don’t fine this technique sufficient, and because of that we actually use an “extended” version of it, where we add an additional hook which has visibility over the data and we can manipulate it as we best see fit.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">http</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">requests</span>


<span class="k">def</span> <span class="nf">httpclient_log</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="c1"># logging.getLogger('requests.packages.urllib3').log(logging.DEBUG, " ".join(args))
</span>

<span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">HTTPConnection</span><span class="p">.</span><span class="n">debuglevel</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">()</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">().</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">requests_log</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">"</span><span class="s">requests.packages.urllib3</span><span class="sh">"</span><span class="p">)</span>
<span class="n">requests_log</span><span class="p">.</span><span class="nf">setLevel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">requests_log</span><span class="p">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">http</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="k">print</span> <span class="o">=</span> <span class="n">httpclient_log</span>

<span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://secariolabs.com</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>While the output from the above script appears very similar, notice the presence of brackets around each line indicating that the data is stored as a tuple and we can manipulate and use it as we wish:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEBUG:urllib3.connectionpool:Starting new HTTP connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:80
<span class="o">(</span><span class="s1">'send:'</span>, <span class="s2">"b'GET / HTTP/1.1</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nHost: secariolabs.com</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nUser-Agent: python-requests/2.27.0</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nAccept-Encoding: gzip, deflate</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nAccept: */*</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nConnection: keep-alive</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n'"</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'reply:'</span>, <span class="s2">"'HTTP/1.1 301 Moved Permanently</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n'"</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Server:'</span>, <span class="s1">'CloudFront'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Date:'</span>, <span class="s1">'Wed, 15 Jun 2022 23:26:56 GMT'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Content-Type:'</span>, <span class="s1">'text/html'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Content-Length:'</span>, <span class="s1">'183'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Connection:'</span>, <span class="s1">'keep-alive'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Location:'</span>, <span class="s1">'https://secariolabs.com/'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-XSS-Protection:'</span>, <span class="s1">'1; mode=block'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Frame-Options:'</span>, <span class="s1">'SAMEORIGIN'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Referrer-Policy:'</span>, <span class="s1">'strict-origin-when-cross-origin'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Content-Type-Options:'</span>, <span class="s1">'nosniff'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Cache:'</span>, <span class="s1">'Redirect from cloudfront'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Via:'</span>, <span class="s1">'1.1 36ca971f60479f380bc64504d2bb0680.cloudfront.net (CloudFront)'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Amz-Cf-Pop:'</span>, <span class="s1">'LHR52-C1'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Amz-Cf-Id:'</span>, <span class="s1">'ZBgLWkjU4pO-hrurXn3Qfz-9pMpZ_0SFbIAhLomz3O6GYvu2KlClbQ=='</span><span class="o">)</span>
DEBUG:urllib3.connectionpool:http://secariolabs.com:80 <span class="s2">"GET / HTTP/1.1"</span> 301 183
DEBUG:urllib3.connectionpool:Starting new HTTPS connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:443
<span class="o">(</span><span class="s1">'send:'</span>, <span class="s2">"b'GET / HTTP/1.1</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nHost: secariolabs.com</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nUser-Agent: python-requests/2.27.0</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nAccept-Encoding: gzip, deflate</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nAccept: */*</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">nConnection: keep-alive</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n'"</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'reply:'</span>, <span class="s2">"'HTTP/1.1 200 OK</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n'"</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Content-Type:'</span>, <span class="s1">'text/html; charset=UTF-8'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Content-Length:'</span>, <span class="s1">'16347'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Connection:'</span>, <span class="s1">'keep-alive'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Date:'</span>, <span class="s1">'Wed, 15 Jun 2022 23:26:57 GMT'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Server:'</span>, <span class="s1">'Apache'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Expires:'</span>, <span class="s1">'Thu, 16 Jun 2022 00:26:57 GMT'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Pragma:'</span>, <span class="s1">'public'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Cache-Control:'</span>, <span class="s1">'max-age=3600, public'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Frame-Options:'</span>, <span class="s1">'SAMEORIGIN'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Strict-Transport-Security:'</span>, <span class="s1">'max-age=63072000'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Mod-Pagespeed:'</span>, <span class="s1">'1.13.35.2-0'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Content-Encoding:'</span>, <span class="s1">'gzip'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Frame-Options:'</span>, <span class="s1">'SAMEORIGIN'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Content-Type-Options:'</span>, <span class="s1">'nosniff'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Referrer-Policy:'</span>, <span class="s1">'no-referrer-when-downgrade'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Permitted-Cross-Domain-Policies:'</span>, <span class="s1">'none'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Feature-Policy:'</span>, <span class="s2">"camera 'none'; fullscreen 'self'; geolocation *; microphone 'none'"</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Permissions-Policy:'</span>, <span class="s1">'geolocation=(*), microphone=(), camera=(), fullscreen=(self)'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Cache-Control:'</span>, <span class="s1">'max-age=0, no-cache, s-maxage=10'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Vary:'</span>, <span class="s1">'Accept-Encoding'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-XSS-Protection:'</span>, <span class="s1">'1; mode=block'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Cache:'</span>, <span class="s1">'Miss from cloudfront'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'Via:'</span>, <span class="s1">'1.1 106f0cae03bb6a218d16ab28ba07c664.cloudfront.net (CloudFront)'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Amz-Cf-Pop:'</span>, <span class="s1">'LHR52-C1'</span><span class="o">)</span>
<span class="o">(</span><span class="s1">'header:'</span>, <span class="s1">'X-Amz-Cf-Id:'</span>, <span class="s1">'nGBi-YV_ni1oJGKFbkZo8ImTfVRLCEc2rQRJMi_y_HPj2cNg6OlY9A=='</span><span class="o">)</span>
DEBUG:urllib3.connectionpool:https://secariolabs.com:443 <span class="s2">"GET / HTTP/1.1"</span> 200 16347
</code></pre></div></div>

<p>Again, this technique comes with the limitation that multiprocessing can create a havoc when trying to match a request with response as they are not directly tied. The data is being printed as it is read on the socket, and not in batches; because of that each HTTP header is printed separately, rather than the whole HTTP packet being a single object.</p>

<h2 id="roundtrip-hook">Roundtrip Hook</h2>

<p>Finally, the most comprehensive – but also involving – technique of doing detailed logging is to use request “hooks”. In essence they allow (either per session or per individual request) to set a hook for a particular action which will be invoked by the <code class="language-plaintext highlighter-rouge">requests</code> module when the action is triggered.</p>

<p>In the example below it could be seen how we are setting a hook for the “response” action and we are providing a function. Once a request is made with a response incoming, the function would be triggered and the request and response will be passed to the function as arguments. With this technique it is possible to confidently know the mapping of request &amp; response.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">textwrap</span>

<span class="k">class</span> <span class="nc">HttpFormatter</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">Formatter</span><span class="p">):</span>   

    <span class="k">def</span> <span class="nf">_formatHeaders</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="sh">'</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">.</span><span class="nf">items</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">formatMessage</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nf">super</span><span class="p">().</span><span class="nf">formatMessage</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="sh">'</span><span class="s">httplogger</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">textwrap</span><span class="p">.</span><span class="nf">dedent</span><span class="p">(</span><span class="sh">'''</span><span class="s">
                ---------------- request ----------------
                {req.method} {req.url}
                {reqhdrs}

                {req.body}
                ---------------- response ----------------
                {res.status_code} {res.reason} {res.url}
                {reshdrs}

                {res.text}
            </span><span class="sh">'''</span><span class="p">).</span><span class="nf">format</span><span class="p">(</span>
                <span class="n">req</span><span class="o">=</span><span class="n">record</span><span class="p">.</span><span class="n">req</span><span class="p">,</span>
                <span class="n">res</span><span class="o">=</span><span class="n">record</span><span class="p">.</span><span class="n">res</span><span class="p">,</span>
                <span class="n">reqhdrs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">_formatHeaders</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">req</span><span class="p">.</span><span class="n">headers</span><span class="p">),</span>
                <span class="n">reshdrs</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">_formatHeaders</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">res</span><span class="p">.</span><span class="n">headers</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="n">formatter</span> <span class="o">=</span> <span class="nc">HttpFormatter</span><span class="p">(</span><span class="sh">'</span><span class="s">{asctime} {levelname} {name} {message}</span><span class="sh">'</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sh">'</span><span class="s">{</span><span class="sh">'</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nc">StreamHandler</span><span class="p">()</span>
<span class="n">handler</span><span class="p">.</span><span class="nf">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">handler</span><span class="p">])</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">'</span><span class="s">httplogger</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">logRoundtrip</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">req</span><span class="sh">'</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">request</span><span class="p">,</span> <span class="sh">'</span><span class="s">res</span><span class="sh">'</span><span class="p">:</span> <span class="n">response</span><span class="p">}</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="sh">'</span><span class="s">HTTP roundtrip</span><span class="sh">'</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">)</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
<span class="n">session</span><span class="p">.</span><span class="n">hooks</span><span class="p">[</span><span class="sh">'</span><span class="s">response</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">logRoundtrip</span><span class="p">)</span>

<span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://secariolabs.com</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>The output of the above command looks as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2022-06-16 00:31:43,991 DEBUG urllib3.connectionpool Starting new HTTP connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:80
2022-06-16 00:31:44,042 DEBUG urllib3.connectionpool http://secariolabs.com:80 <span class="s2">"GET / HTTP/1.1"</span> 301 183
2022-06-16 00:31:44,043 DEBUG httplogger HTTP roundtrip
<span class="nt">----------------</span> request <span class="nt">----------------</span>
GET http://secariolabs.com/
User-Agent: python-requests/2.27.0
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive

None
<span class="nt">----------------</span> response <span class="nt">----------------</span>
301 Moved Permanently http://secariolabs.com/
Server: CloudFront
Date: Wed, 15 Jun 2022 23:31:46 GMT
Content-Type: text/html
Content-Length: 183
Connection: keep-alive
Location: https://secariolabs.com/
X-XSS-Protection: 1<span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block
X-Frame-Options: SAMEORIGIN
Referrer-Policy: strict-origin-when-cross-origin
X-Content-Type-Options: nosniff
X-Cache: Redirect from cloudfront
Via: 1.1 2fafb26bfb5e0420de152a7abef27a44.cloudfront.net <span class="o">(</span>CloudFront<span class="o">)</span>
X-Amz-Cf-Pop: LHR52-C1
X-Amz-Cf-Id: 5WSuiFqiDF_me87HjfB02e4XSkp8ZMWTauHSvVQawC9Hg51bjH9K-Q<span class="o">==</span>

&lt;html&gt;
&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;
&lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">"white"</span><span class="o">&gt;</span>
&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;CloudFront&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;

2022-06-16 00:31:44,047 DEBUG urllib3.connectionpool Starting new HTTPS connection <span class="o">(</span>1<span class="o">)</span>: secariolabs.com:443
2022-06-16 00:31:44,132 DEBUG urllib3.connectionpool https://secariolabs.com:443 <span class="s2">"GET / HTTP/1.1"</span> 200 16347
2022-06-16 00:31:44,133 DEBUG httplogger HTTP roundtrip
<span class="nt">----------------</span> request <span class="nt">----------------</span>
GET https://secariolabs.com/
User-Agent: python-requests/2.27.0
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept: <span class="k">*</span>/<span class="k">*</span>
Connection: keep-alive

None
<span class="nt">----------------</span> response <span class="nt">----------------</span>
200 OK https://secariolabs.com/
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 16347
Connection: keep-alive
Date: Wed, 15 Jun 2022 23:31:46 GMT
Server: Apache
Expires: Thu, 16 Jun 2022 00:31:46 GMT
Pragma: public
Cache-Control: max-age<span class="o">=</span>3600, public, max-age<span class="o">=</span>0, no-cache, s-maxage<span class="o">=</span>10
X-Frame-Options: SAMEORIGIN, SAMEORIGIN
Strict-Transport-Security: max-age<span class="o">=</span>63072000
X-Mod-Pagespeed: 1.13.35.2-0
Content-Encoding: <span class="nb">gzip
</span>X-Content-Type-Options: nosniff
Referrer-Policy: no-referrer-when-downgrade
X-Permitted-Cross-Domain-Policies: none
Feature-Policy: camera <span class="s1">'none'</span><span class="p">;</span> fullscreen <span class="s1">'self'</span><span class="p">;</span> geolocation <span class="k">*</span><span class="p">;</span> microphone <span class="s1">'none'</span>
Permissions-Policy: <span class="nv">geolocation</span><span class="o">=(</span><span class="k">*</span><span class="o">)</span>, <span class="nv">microphone</span><span class="o">=()</span>, <span class="nv">camera</span><span class="o">=()</span>, <span class="nv">fullscreen</span><span class="o">=(</span>self<span class="o">)</span>
Vary: Accept-Encoding
X-XSS-Protection: 1<span class="p">;</span> <span class="nv">mode</span><span class="o">=</span>block
X-Cache: Miss from cloudfront
Via: 1.1 44a651f8e3a1f38a5a977c4f0c4d45a0.cloudfront.net <span class="o">(</span>CloudFront<span class="o">)</span>
X-Amz-Cf-Pop: LHR52-C1
X-Amz-Cf-Id: 7eReUC-yuJugzYBRCVoKauftHc53DvdsKi1hx1pU5M9TjJc_Ml6n9Q<span class="o">==</span>

&lt;<span class="o">!</span>DOCTYPE html&gt;
<span class="o">[</span>...snip...]

</code></pre></div></div>

<p>This concludes our quick look into HTTP logging using Python.</p>

<p>Future research could focus on websocket logging (something we are starting to see more of), as well as a way to add a default hook to <code class="language-plaintext highlighter-rouge">requests</code>, rather than having to set one per session and then having to manually track that all session objects have this hook.</p>

<p>The article was written by <a href="https://twitter.com/saldat0" title="@saldat0">@saldat0</a></p>
</article><div class="post__nav-wrapper">
        <h3 class="post__nav-heading">More articles</h3>

        <div class="post__nav"><a
            class="post__nav-item post__nav-item--next"
            href="/analysing-and-reproducing-poc-for-log4j-2-15-0/"
          >Analysing and Reproducing PoC for Log4j 2.15.0</a></div>
      </div></div>
  </section>
</section><div id="lightbox" class="lightbox opacity-0 z_-10">
    <figure id="lightbox-figure" class="lightbox__figure">
        <img src="" alt="" class="lightbox__img">
        <figcaption class="lightbox__caption"></figcaption>
        <svg id="close-lightbox-control" class="lightbox__close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </figure>
</div>
    </main><footer class="site-footer">
    <div class="container">

        <div class="site-footer__logo-wrapper">
            <a href="/" class="site-footer__logo-link">
                <img class="site-footer__logo" src="/assets/images/secario-labs-logo.png" alt="Secario Labs logo" width="462" height="58">
            </a>
        </div>

        <div class="site-footer__cols site-footer__cols--3">

            <div class="site-footer__col site-footer__col--desc">

                <div class="site-footer__desc">
                    <p>Secario Labs offers expertly delivered cyber security services, security testing and solutions that are geared to your risk profile and security needs. Combining skills, experience and methodologies to provide offensive cyber security solutions.</p>

                </div>
            </div>

            <div class="site-footer__col site-footer__col--location">
                <p>
                    <strong>Bulgaria Office</strong><br>
                    66 Vitosha Blvd.<br>Sofia, 1463<br>Bulgaria
                </p>
                <p>
                    <a class="site-footer__link" href="tel:+359882357332">
                        +359 882 357332
                    </a>
                    <br>
                    <a class="site-footer__link" href="mailto:info@secariolabs.com">
                        info@secariolabs.com
                    </a>
                </p>
            </div>

            <div class="site-footer__col site-footer__col--location">
                <p>
                    <strong>UK Office</strong><br>
                    Worth Corner, Pound Hill,<br>Crawley, RH10 7SL<br>United Kingdom
                </p>
                <p>
                    <a class="site-footer__link" href="tel:+447389796754">
                        +44 7389 796754
                    </a>
                    <br>
                    <a class="site-footer__link" href="mailto:info@secariolabs.com">
                        info@secariolabs.com
                    </a>
                </p>                
            </div>

        </div>

        <div class="site-footer__cols site-footer__cols--2">
            <div class="site-footer__col">
                <label class="site-footer__form-label" for="email">Sign up to our newsletter</label><div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
    <div id="mc_embed_signup">
        <form action="https://secariolabs.us6.list-manage.com/subscribe/post?u=daf217615566079f0ccc22426&amp;id=9fa5ad3243&amp;f_id=002628e3f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
            <div id="mc_embed_signup_scroll" class="site-footer__form-fields">
                <input type="email" name="EMAIL" class="required email input__text input__text--xl" id="mce-EMAIL" required="" value="" placeholder="Your email">
                <div style="position: absolute; left: -5000px;" aria-hidden="true">
                    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups -->
                    <input type="text" name="b_daf217615566079f0ccc22426_9fa5ad3243" tabindex="-1" value="">
                </div>
                <div class="optionalParent">
                    <div class="clear foot">
                        <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="site-footer__form-submit btn btn--xl btn--light uppercase" value="Subscribe"></div>
                </div>
            </div>

            <div id="mce-responses" class="clear foot">
                <div class="response" id="mce-error-response" style="display: none;">😐 Error!</div>
                <div class="response" id="mce-success-response" style="display: none;">✅ Success!</div>
            </div>
        </form>
    </div>
    <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>
    <script type="text/javascript">
        (function($) {
            window.fnames = new Array();
            window.ftypes = new Array();
            fnames[0] = 'EMAIL';
            ftypes[0] = 'email';
            fnames[1] = 'FNAME';
            ftypes[1] = 'text';
            fnames[2] = 'LNAME';
            ftypes[2] = 'text';
            fnames[3] = 'ADDRESS';
            ftypes[3] = 'address';
            fnames[4] = 'PHONE';
            ftypes[4] = 'phone';
            fnames[5] = 'BIRTHDAY';
            ftypes[5] = 'birthday';
        }(jQuery));
        var $mcj = jQuery.noConflict(true);
    </script>
</div></div>
            <div class="site-footer__col">
                <h3 class="site-footer__social-heading">
                    Connect With Us
                </h3>
                <div class="site-footer__social">
                    <a href="https://www.linkedin.com/company/secariolabs" class="site-footer__social-item" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" aria-hidden="true" viewBox="0 0 24 24"><path d="M19.7 3H4.3A1.3 1.3 0 0 0 3 4.3v15.4A1.3 1.3 0 0 0 4.3 21h15.4a1.3 1.3 0 0 0 1.3-1.3V4.3A1.3 1.3 0 0 0 19.7 3zM8.339 18.338H5.667v-8.59h2.672v8.59zM7.004 8.574a1.548 1.548 0 1 1-.002-3.096 1.548 1.548 0 0 1 .002 3.096zm11.335 9.764H15.67v-4.177c0-.996-.017-2.278-1.387-2.278-1.389 0-1.601 1.086-1.601 2.206v4.249h-2.667v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.779 3.203 4.092v4.711z"/></svg></a>
                    <a href="https:/x.com/SecarioLabs" class="site-footer__social-item" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z"/></svg></a>
                    <a href="mailto:info@secariolabs.com" class="site-footer__social-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" aria-hidden="true" viewBox="0 0 24 24"><path d="M19 5H5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm.5 12c0 .3-.2.5-.5.5H5c-.3 0-.5-.2-.5-.5V9.8l7.5 5.6 7.5-5.6V17zm0-9.1L12 13.6 4.5 7.9V7c0-.3.2-.5.5-.5h14c.3 0 .5.2.5.5v.9z"/></svg></a>
                    
                </div>
            </div>
        </div>

        <div class="site-footer__bottom">
            <span class="site-footer__bottom-item">All content © 2024 Secario Labs
                    </span><a class="site-footer__bottom-item site-footer__link" href="/privacy-policy/">Privacy Policy</a><a class="site-footer__bottom-item site-footer__link" href="/modern-slavery-policy/">Modern Slavery Policy</a><a class="site-footer__bottom-item site-footer__link" href="/contact/">Contact</a>
        </div>

    </div>
</footer><div id="modal" class="lightbox modal opacity-0 z_-10" data-i_frame="https://outlook.office365.com/owa/calendar/SecarioLabs@secariolabs.com/bookings/">
    <div class="modal__container">
        <div class="modal__content-container">
            <iframe src='' width='100%' height='100%' scrolling='yes' style='border:0'></iframe>
        </div>
        <svg id="close-modal-control" class="lightbox__close modal__close" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </div>
</div><script src="/assets/js/slidetoggle.js"></script><script src="/assets/js/prism.js"></script><script src="/assets/js/scripts.js"></script><script>function handle_lightbox(figure_elements, element_type){

    const lightbox = document.getElementById('lightbox');
    const lightbox_img = lightbox.querySelector('img');
    const lightbox_caption = lightbox.querySelector('figcaption');
    const figures = document.querySelectorAll(figure_elements);
    const the_figure = document.getElementById('lightbox-figure');
    const close_control = document.getElementById('close-lightbox-control');
    const the_body = document.querySelector('body');

    let the_img;
    let the_caption = '';
    
    function open_figure(e){
        const $this = e.currentTarget;

        if(element_type === 'figure'){
            the_img = $this.querySelector('img');
            if($this.querySelector('figcaption')){
                the_caption = $this.querySelector('figcaption').innerHTML;
                lightbox_caption.classList.add('py-0_5rem');
                lightbox_caption.classList.add('px-1rem');
            } else {
                the_caption = '';
            }

        } else if(element_type === 'img'){
            the_img = $this;
        }

        const the_src = the_img.src;

        the_body.classList.add('no-scroll');

        lightbox_img.src = the_src;
        lightbox_caption.innerHTML = the_caption;

        lightbox.classList.remove('z_-10');
        lightbox.classList.remove('opacity-0');
        lightbox.classList.add('opacity-1');

        the_figure.classList.add('translate-y-0');
    }
    
    function close_figure(){
        lightbox_img.src = '';
        lightbox_caption.innerHTML = '';

        the_body.classList.remove('no-scroll');

        lightbox_caption.classList.remove('py-0_5rem');
        lightbox_caption.classList.remove('px-1rem');

        the_figure.classList.remove('translate-y-0');

        lightbox.classList.remove('opacity-1');
        lightbox.classList.add('opacity-0');
        lightbox.classList.add('z_-10');
    }

    figures.forEach(function(el){
        el.addEventListener('click', open_figure);
    });

    close_control.addEventListener('click', close_figure);

    document.addEventListener('click', function(e){
        if(e.target.id === 'lightbox'){
            close_figure();
        }
    });

    window.addEventListener('keydown', keyPress);
    
    function keyPress (e) {
        if(e.key === "Escape") {
            close_figure();
        }
    }

}handle_lightbox('article.post p:has(img:only-of-type) img', 'img');
    </script><script>function handle_modal(){

    const modal = document.getElementById('modal');
    const the_container = modal.querySelector('.modal__container');
    const close_control = document.getElementById('close-modal-control');
    const the_body = document.querySelector('body');
    const iframe_url = modal.dataset.i_frame;
    const the_iframe = modal.querySelector('iframe');
    
    function open_modal(){

        the_iframe.src = iframe_url;

        the_body.classList.add('no-scroll');

        modal.classList.remove('z_-10');
        modal.classList.remove('opacity-0');
        modal.classList.add('opacity-1');

        the_container.classList.add('translate-y-0');
    }
    
    function close_modal(){

        the_iframe.src = '';
        
        the_body.classList.remove('no-scroll');

        the_container.classList.remove('translate-y-0');

        modal.classList.remove('opacity-1');
        modal.classList.add('opacity-0');
        modal.classList.add('z_-10');
    }

    close_control.addEventListener('click', close_modal);

    document.addEventListener('click', function(e){
        if(e.target.id === 'modal'){
            close_modal();
        }
    });

    window.addEventListener('keydown', keyPress);
    
    function keyPress (e) {
        if(e.key === "Escape") {
            close_modal();
        }
    }

    document.querySelectorAll('[data-open-modal]').forEach(function(el){
        el.addEventListener('click', function(e){
            e.preventDefault();
            open_modal();
        });
    });

}

handle_modal()</script></body>

</html>
